{% extends 'base/base.html' %}
{% load static %}

{% block title %}Accueil - Agence de Transport{% endblock %}

{% block content %}
<!-- Hero Section -->
<div class="hero-section bg-primary text-white py-5 mb-5">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-6">
                <h1 class="display-4 fw-bold mb-3">Voyagez en toute sérénité</h1>
                <p class="lead mb-4">Réservez vos billets de train en quelques clics et profitez d'un voyage confortable et sécurisé.</p>
                <a href="{% url 'search' %}" class="btn btn-light btn-lg">Réserver maintenant</a>
            </div>
            <div class="col-lg-6 d-none d-lg-block">
                <img src="{% static 'images/train-hero.png' %}" alt="Train de voyage" class="img-fluid">
            </div>
        </div>
    </div>
</div>

<!-- Search Form -->
<div class="container">
    <div class="card shadow-lg mb-5">
        <div class="card-body p-4">
            <h2 class="text-center mb-4">Trouvez votre prochain trajet</h2>
            <form method="get" action="{% url 'search' %}" class="row g-3">
                <div class="col-md-4">
                    <label for="departure" class="form-label">Départ</label>
                    <select class="form-select" id="departure" name="departure" required>
                        <option value="" selected disabled>Sélectionnez une gare de départ</option>
                        {% for gare in gares %}
                            <option value="{{ gare.id }}">{{ gare.nom }} - {{ gare.ville.nom }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-4">
                    <label for="arrival" class="form-label">Arrivée</label>
                    <select class="form-select" id="arrival" name="arrival" required>
                        <option value="" selected disabled>Sélectionnez une gare d'arrivée</option>
                        {% for gare in gares %}
                            <option value="{{ gare.id }}">{{ gare.nom }} - {{ gare.ville.nom }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-2">
                    <label for="date" class="form-label">Date</label>
                    <input type="date" class="form-control" id="date" name="date" min="{% now 'Y-m-d' %}" required>
                </div>
                <div class="col-md-2 d-flex align-items-end">
                    <button type="submit" class="btn btn-primary w-100">Rechercher</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Features Section -->
    <div class="row text-center mb-5">
        <div class="col-md-4 mb-4">
            <div class="card h-100 border-0 shadow-sm">
                <div class="card-body">
                    <div class="feature-icon bg-primary bg-gradient text-white rounded-3 mb-3 p-3 d-inline-block">
                        <i class="fas fa-ticket-alt fa-2x"></i>
                    </div>
                    <h3>Réservation facile</h3>
                    <p class="text-muted">Réservez vos billets en quelques clics, sans attente.</p>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-4">
            <div class="card h-100 border-0 shadow-sm">
                <div class="card-body">
                    <div class="feature-icon bg-primary bg-gradient text-white rounded-3 mb-3 p-3 d-inline-block">
                        <i class="fas fa-euro-sign fa-2x"></i>
                    </div>
                    <h3>Meilleurs prix</h3>
                    <p class="text-muted">Bénéficiez des meilleurs tarifs pour vos déplacements.</p>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-4">
            <div class="card h-100 border-0 shadow-sm">
                <div class="card-body">
                    <div class="feature-icon bg-primary bg-gradient text-white rounded-3 mb-3 p-3 d-inline-block">
                        <i class="fas fa-headset fa-2x"></i>
                    </div>
                    <h3>Service client</h3>
                    <p class="text-muted">Une équipe à votre écoute 7j/7 pour vous accompagner.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Popular Routes -->
    <h2 class="text-center mb-4">Destinations populaires</h2>
    <div class="row mb-5">
        {% for trajet in trajets_populaires %}
        <div class="col-md-4 mb-4">
            <div class="card h-100 shadow-sm">
                <img src="{{ trajet.image_url|default:'/static/images/default-route.jpg' }}" class="card-img-top" alt="{{ trajet.depart.nom }} - {{ trajet.arrivee.nom }}">
                <div class="card-body">
                    <h5 class="card-title">{{ trajet.depart.ville.nom }} → {{ trajet.arrivee.ville.nom }}</h5>
                    <p class="card-text">À partir de <span class="h5 text-primary">{{ trajet.prix_min }}€</span></p>
                    <a href="{% url 'search' %}?departure={{ trajet.depart.id }}&arrival={{ trajet.arrivee.id }}" class="btn btn-outline-primary">Voir les horaires</a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Initialiser la date du jour par défaut
    document.addEventListener('DOMContentLoaded', function() {
        const today = new Date();
        const dateInput = document.getElementById('date');
        if (dateInput && !dateInput.value) {
            // Formater la date au format YYYY-MM-DD
            const formattedDate = today.toISOString().split('T')[0];
            dateInput.value = formattedDate;
        }
        
        // Désactiver la sélection de la même gare de départ et d'arrivée
        const departureSelect = document.getElementById('departure');
        const arrivalSelect = document.getElementById('arrival');
        
        if (departureSelect && arrivalSelect) {
            departureSelect.addEventListener('change', function() {
                if (this.value === arrivalSelect.value) {
                    arrivalSelect.value = '';
                }
            });
            
            arrivalSelect.addEventListener('change', function() {
                if (this.value === departureSelect.value) {
                    departureSelect.value = '';
                }
            });
        }
    });
</script>
{% endblock %}
